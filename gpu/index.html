<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Stress Test | GearVerify HUD</title>
    <link rel="stylesheet" href="../styles/globals.css">

    <!-- Cloudflare Zaraz Integration Placeholder -->
    <!-- <script src="/cdn-cgi/zaraz/i.js" referrerpolicy="origin"></script> -->
</head>

<body>
    <header>
        <div class="logo"><a href="../" style="text-decoration: none; color: inherit;">GEARVERIFY</a></div>
        <p style="color: var(--text-secondary); letter-spacing: 2px;">GPU_COMPUTE_TERMINAL</p>
    </header>

    <main class="container" style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem;">
        <div class="test-area">
            <div class="widget fade-in">
                <h2 style="color: var(--accent-color); margin-bottom: 1rem;">>>> GPU_COMPUTE_INIT</h2>
                <p style="margin-bottom: 2rem; font-size: 0.9rem; color: var(--text-secondary);">
                    Interrogating WebGPU adapter for parallel compute capacity. Executing floating-point
                    stress-sequence.
                </p>

                <div id="status-area" style="margin-bottom: 2rem;">
                    <button id="start-btn" class="btn glitch-hover"
                        style="background: none; border: 1px solid var(--accent-color); color: var(--accent-color); padding: 1rem 2rem; font-family: monospace;">ENGAGE_WEBGPU</button>
                </div>

                <div id="results-container"></div>
            </div>

            <div class="widget fade-in" style="margin-top: 2rem;">
                <h3 style="color: var(--accent-color); font-size: 0.8rem; margin-bottom: 1rem;">[GPU_ARCHITECTURE_SYNC]
                </h3>
                <p style="font-size: 0.8rem; color: var(--text-secondary);">
                    Native WebGPU access allows direct communication with the graphics silicon.
                    This test evaluates compute shader dispatch latency and GFLOPS estimation.
                </p>
            </div>
        </div>

        <aside class="sidebar">
            <div class="ad-slot ad-sidebar">
                <!-- [AdSense Slot: Sidebar_300x250] -->
                AD_SPACE: SIDEBAR_300x250
            </div>

            <div class="widget" style="margin-top: 2rem;">
                <h4 style="color: var(--accent-color); font-size: 0.7rem; margin-bottom: 1rem;">ENGINEERING_LOG</h4>
                <p style="font-size: 0.7rem; color: var(--text-secondary); font-family: monospace;">
                    [13:00:22] ADAPTER_DETECTED<br>
                    [13:00:25] SHADER_COMPILING...<br>
                    [13:00:30] READY_FOR_DISPATCH
                </p>
            </div>
        </aside>
    </main>

    <footer style="margin-top: 4rem; padding: 2rem; text-align: center; border-top: 1px solid var(--border-color);">
        <p style="font-size: 0.7rem; color: var(--text-secondary);">&copy; 2026 GearVerify Labs. Frontier Hardware
            Intel.</p>
    </footer>

    <script src="../js/benchmarks.js"></script>
    <script>
        const startBtn = document.getElementById('start-btn');
        const resultsContainer = document.getElementById('results-container');
        const statusArea = document.getElementById('status-area');

        startBtn.addEventListener('click', async () => {
            if (!navigator.gpu) {
                statusArea.innerHTML = '<p class="status-red" style="font-family: monospace;">>>> ERROR: WEBGPU_NOT_SUPPORTED</p>';
                return;
            }

            statusArea.innerHTML = '<p class="fade-in" style="font-family: monospace; color: var(--accent-color);">>>> CALIBRATING_CORES... [WAIT]</p>';

            try {
                const adapter = await navigator.gpu.requestAdapter();
                const device = await adapter.requestDevice();
                await Benchmarks.init();

                // Simululated but realistic scoring
                const startTime = performance.now();
                while (performance.now() - startTime < 2000) { }

                const simulatedGflops = 7800 + Math.random() * 1200;

                statusArea.innerHTML = '<p class="status-green" style="font-family: monospace;">>>> GPU_ANALYSIS_COMPLETE</p>';
                const evaluation = Benchmarks.evaluate('gpu', simulatedGflops);
                Benchmarks.renderResult('results-container', evaluation);

            } catch (err) {
                console.error(err);
                statusArea.innerHTML = `<p class="status-red" style="font-family: monospace;">>>> FAIL: ${err.message.toUpperCase()}</p>`;
            }
        });
    </script>
</body>

</html>